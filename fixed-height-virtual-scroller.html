<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>固定高度 Virtual Scroller 範例</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f0f2f5;
      display: flex;
      justify-content: center;
      padding: 40px 20px;
    }

    .wrapper {
      width: 500px;
    }

    h1 {
      font-size: 22px;
      margin-bottom: 8px;
      color: #1a1a1a;
    }

    .stats {
      margin-bottom: 16px;
      padding: 12px 16px;
      background: #fff;
      border-radius: 8px;
      font-size: 14px;
      color: #555;
      display: flex;
      gap: 20px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
    }

    .stats span {
      font-weight: 600;
      color: #1a73e8;
    }

    /* ---- Virtual Scroller 容器 ---- */
    .scroll-container {
      height: 500px;
      overflow-y: auto;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
      position: relative;
    }

    /* 撐出完整高度的佔位元素 */
    .scroll-spacer {
      position: relative;
    }

    /* 可見項目的容器，透過 transform 定位 */
    .scroll-content {
      position: absolute;
      left: 0;
      right: 0;
    }

    /* 每個列表項目 */
    .list-item {
      height: 50px;
      display: flex;
      align-items: center;
      padding: 0 20px;
      border-bottom: 1px solid #f0f0f0;
      font-size: 14px;
      color: #333;
      transition: background 0.15s;
    }

    .list-item:hover {
      background: #f5f8ff;
    }

    .list-item .index {
      width: 60px;
      font-weight: 600;
      color: #1a73e8;
      flex-shrink: 0;
    }

    .list-item .text {
      flex: 1;
    }

    .list-item .badge {
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 500;
    }

    .badge.even {
      background: #e8f0fe;
      color: #1a73e8;
    }

    .badge.odd {
      background: #fce8e6;
      color: #d93025;
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <h1>Fixed Height Virtual Scroller</h1>

    <div class="stats">
      <div>總項目數：<span id="totalCount">-</span></div>
      <div>已渲染 DOM：<span id="renderedCount">-</span></div>
      <div>目前範圍：<span id="rangeDisplay">-</span></div>
    </div>

    <div class="scroll-container" id="scrollContainer">
      <div class="scroll-spacer" id="scrollSpacer">
        <div class="scroll-content" id="scrollContent"></div>
      </div>
    </div>
  </div>

  <script>
    // ============================================
    //  固定高度 Virtual Scroller 實作
    // ============================================

    const TOTAL_ITEMS = 100000;   // 10 萬筆資料
    const ITEM_HEIGHT = 50;       // 每個項目固定 50px
    const OVERSCAN = 5;           // 可視區外額外渲染的項目數（上下各 5 個）

    // 模擬資料
    const data = Array.from({ length: TOTAL_ITEMS }, (_, i) => ({
      id: i,
      name: `Item #${i} — 這是第 ${i.toLocaleString()} 筆資料`,
    }));

    // DOM 元素
    const container = document.getElementById('scrollContainer');
    const spacer = document.getElementById('scrollSpacer');
    const content = document.getElementById('scrollContent');
    const totalCountEl = document.getElementById('totalCount');
    const renderedCountEl = document.getElementById('renderedCount');
    const rangeDisplayEl = document.getElementById('rangeDisplay');

    // 設定總高度，讓捲軸能正常顯示
    const totalHeight = TOTAL_ITEMS * ITEM_HEIGHT;
    spacer.style.height = `${totalHeight}px`;

    // 顯示總項目數
    totalCountEl.textContent = TOTAL_ITEMS.toLocaleString();

    /**
     * 核心渲染函式
     * 根據目前 scrollTop 計算要顯示哪些項目，並渲染到 DOM
     */
    function render() {
      const scrollTop = container.scrollTop;
      const containerHeight = container.clientHeight;

      // 1. 計算可見範圍的起始與結束索引
      const startIndex = Math.floor(scrollTop / ITEM_HEIGHT);
      const endIndex = Math.ceil((scrollTop + containerHeight) / ITEM_HEIGHT);

      // 2. 加上 overscan 緩衝區
      const renderStart = Math.max(0, startIndex - OVERSCAN);
      const renderEnd = Math.min(TOTAL_ITEMS, endIndex + OVERSCAN);

      // 3. 透過 transform 偏移，讓內容對齊正確位置
      const offsetY = renderStart * ITEM_HEIGHT;
      content.style.transform = `translateY(${offsetY}px)`;

      // 4. 渲染可見項目
      let html = '';
      for (let i = renderStart; i < renderEnd; i++) {
        const item = data[i];
        const badgeClass = i % 2 === 0 ? 'even' : 'odd';
        const badgeText = i % 2 === 0 ? '偶數' : '奇數';
        html += `
          <div class="list-item">
            <div class="index">#${item.id}</div>
            <div class="text">${item.name}</div>
            <div class="badge ${badgeClass}">${badgeText}</div>
          </div>
        `;
      }
      content.innerHTML = html;

      // 5. 更新統計資訊
      const renderedCount = renderEnd - renderStart;
      renderedCountEl.textContent = renderedCount;
      rangeDisplayEl.textContent = `${renderStart.toLocaleString()} - ${(renderEnd - 1).toLocaleString()}`;
    }

    // 監聽滾動事件
    container.addEventListener('scroll', render);

    // 初次渲染
    render();
  </script>
</body>
</html>
